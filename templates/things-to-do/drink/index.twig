{% set isAjax = craft.app.request.isAjax %}
{% extends isAjax ? '_layouts/ajax' : '_layouts/default' %}

{% set areasFilter = craft.app.request.getParam('areas') %}
{% set barQuery = craft.app.get('bars').filter({
    areas: areasFilter,
    orderBy: 'title asc'
}) %}

{% set areas = craft.entries.section('areas').orderBy('title asc').all %}
{% block content %}
    {% if isAjax %}
        {% set showPlaces = [] %}
        {% for place in barQuery.all %}
            {% if place.location is not empty %}
                {% set showPlaces = showPlaces |merge([place.location]) %}
            {% endif %}
        {% endfor %}

        {{ showPlaces | json_encode | raw }}
    {% else %}
        {% include '_partials/wysiwyg' with {
            content : {
                sectionHeading: 'Drink',
                copy: ''
            }
        } only %}
        
        {% include 'things-to-do/listingFilter' with {
            type: 'things-to-do/drink',
            areas: areas,
        } only %}

        {% include '_partials/map' with {
            places: barQuery.all(),
        } only %}
    {% endif %}
{% endblock %}