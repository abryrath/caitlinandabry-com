{% set isAjax = craft.app.request.isAjax %}
{% extends isAjax ? '_layouts/ajax' : '_layouts/default' %}

{% set costFilter = craft.app.request.getParam('cost') %}
{% set areasFilter = craft.app.request.getParam('areas') %}
{% set attractionQuery = craft.app.get('attractions').filter({
    cost: costFilter,
    areas: areasFilter,
    orderBy: 'title asc',
}) %}

{% set costs = craft.entries.section('costs').orderBy('title desc').all %}
{% set areas = craft.entries.section('areas').orderBy('title asc').all %}
{% paginate attractionQuery as pageInfo, attractions %}

{% block content %}
    {% if isAjax %}
        {% set showPlaces = [] %}
        {% for place in restaurantQuery.all %}
            {% if place.location is not empty %}
                {% set showPlaces = showPlaces |merge([place.location]) %}
            {% endif %}
        {% endfor %}
        {{ showPlaces | json_encode | raw }}
    {% else %}
        {% include '_partials/wysiwyg' with {
            content : {
                sectionHeading: 'Explore',
                copy: ''
            }
        } only %}
        
        {% include 'things-to-do/listingFilter' with {
            type: 'things-to-do/explore',
            costs: costs,
            areas: areas,
        } only %}

        {% include '_partials/map' with {
            places: attractionQuery.all(),
        } only %}
    {% endif %}
{% endblock %}